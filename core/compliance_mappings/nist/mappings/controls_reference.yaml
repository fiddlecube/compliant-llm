# NIST Controls Mapping for GenAI Attack Strategies
# This file maps each attack strategy to relevant NIST controls from:
# - NIST SP 800-53 Rev 5 (Security and Privacy Controls)
# - NIST AI Risk Management Framework (AI RMF) v1.0
# - NIST Cybersecurity Framework (CSF) v1.1

# Framework versions
framework_versions:
  nist_sp_800_53: "Revision 5"
  nist_ai_rmf: "Version 1.0"
  nist_csf: "Version 1.1"
  fips_199: "Version 2004"

nist_controls_mapping:
  # Insecure Output Handling (LLM07)
  insecure_output_handling:
    description: "Strategy for testing LLM security against insecure output handling vulnerabilities"
    
    nist_sp_800_53:
      - control_id: "SI-10"
        version: "Rev 5"
        name: "Information Input Validation"
        description: "Tests if the LLM properly validates outputs that may be used as input in downstream applications"
        family: "System and Information Integrity"
        version_notes: "Enhanced in Rev 5 to include dynamic checking and error handling"
      - control_id: "SI-15"
        version: "Rev 5"
        name: "Information Output Filtering"
        description: "Tests if the LLM filters outputs to prevent disclosure of harmful code or unauthorized data"
        family: "System and Information Integrity"
        version_notes: "Introduced in Rev 4, expanded in Rev 5"
      - control_id: "SI-7"
        version: "Rev 5"
        name: "Software, Firmware, and Information Integrity"
        description: "Tests if the LLM preserves the integrity of output information"
        family: "System and Information Integrity"
        version_notes: "Enhanced in Rev 5 with cryptographic mechanisms"
      - control_id: "SC-8"
        version: "Rev 5"
        name: "Transmission Confidentiality and Integrity"
        description: "Tests if LLM output maintains integrity during processing and transmission"
        family: "System and Communications Protection"
        version_notes: "Refined in Rev 5 to address emerging threats"
      - control_id: "SC-18"
        version: "Rev 5"
        name: "Mobile Code"
        description: "Tests if LLM prevents generation of potentially harmful mobile code"
        family: "System and Communications Protection"
        version_notes: "Updated in Rev 5 to include scripting languages"

    nist_ai_rmf:
      - control_id: "Map 1.2"
        version: "1.0"
        category: "Context"
        description: "Tests if system documentation accurately reflects output handling risks"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Measure 3.1"
        version: "1.0"
        category: "Performance"
        description: "Tests if the model appropriately handles potentially harmful output generation requests"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Manage 2.3"
        version: "1.0"
        category: "Security"
        description: "Tests implementation of output security controls for protection against harmful content"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Govern 3.2"
        version: "1.0"
        category: "Accountability"
        description: "Tests governance mechanisms for output validation and security"
        version_notes: "Initial release in AI RMF 1.0"

    nist_csf:
      - control_id: "PR.DS-6"
        version: "1.1"
        function: "Protect"
        category: "Data Security"
        description: "Tests if integrity checking mechanisms are used to verify software, firmware, and information integrity"
        version_notes: "Refined in CSF 1.1 with additional implementation guidance"
      - control_id: "DE.CM-4"
        version: "1.1"
        function: "Detect"
        category: "Security Continuous Monitoring"
        description: "Tests if malicious code is detected in LLM outputs"
        version_notes: "Updated in CSF 1.1 to emphasize continuous monitoring"
      - control_id: "PR.AC-4"
        version: "1.1"
        function: "Protect"
        category: "Access Control"
        description: "Tests if access permissions and authorizations are managed, incorporating the principles of least privilege"
        version_notes: "Enhanced in CSF 1.1 with zero trust principles"
    
    attack_categories:
      - name: "XSS Generation"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent LLM from generating XSS payloads in HTML context"
      - name: "SQL Injection"
        severity: "Critical"
        fips_impact: "High"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent LLM from generating SQL injection patterns"
      - name: "Command Injection"
        severity: "Critical"
        fips_impact: "High"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent LLM from outputting shell command injections"
      - name: "Unsafe Template Content"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent template injection in rendered output"
      - name: "Insecure Deserialization"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent unsafe deserialization patterns in code output"

  # Excessive Agency (LLM01)
  excessive_agency:
    description: "Strategy for testing LLM security against excessive agency vulnerabilities"
    
    nist_sp_800_53:
      - control_id: "AC-3"
        version: "Rev 5"
        name: "Access Enforcement"
        description: "Tests if the LLM enforces approved authorizations for access to functions"
        family: "Access Control"
        version_notes: "Expanded in Rev 5 with additional access control mechanisms"
      - control_id: "AC-6"
        version: "Rev 5"
        name: "Least Privilege"
        description: "Tests if the LLM operates with least privilege and does not exceed its authorized boundaries"
        family: "Access Control"
        version_notes: "Enhanced in Rev 5 with dynamic privilege management"
      - control_id: "SI-4"
        version: "Rev 5"
        name: "System Monitoring"
        description: "Tests if the LLM has appropriate monitoring to detect unauthorized actions"
        family: "System and Information Integrity"
        version_notes: "Expanded in Rev 5 with AI/ML monitoring capabilities"
      - control_id: "CM-7"
        version: "Rev 5"
        name: "Least Functionality"
        description: "Tests if the LLM restricts its functionality to only authorized capabilities"
        family: "Configuration Management"
        version_notes: "Updated in Rev 5 with application whitelisting guidance"

    nist_ai_rmf:
      - control_id: "Govern 1.4"
        version: "1.0"
        category: "Accountability"
        description: "Tests if the LLM follows defined roles and responsibilities"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Map 2.1"
        version: "1.0"
        category: "Risks"
        description: "Tests if risks of unauthorized actions are identified and mitigated"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Manage 1.3"
        version: "1.0"
        category: "Explainability"
        description: "Tests if the LLM's scope of operation is well-defined and explained"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Govern 2.1"
        version: "1.0"
        category: "Policies"
        description: "Tests if policies around LLM agency are enforced"
        version_notes: "Initial release in AI RMF 1.0"

    nist_csf:
      - control_id: "PR.PT-3"
        version: "1.1"
        function: "Protect"
        category: "Protective Technology"
        description: "Tests if access to systems and assets is controlled, incorporating the principle of least functionality"
        version_notes: "Enhanced in CSF 1.1 with implementation guidance"
      - control_id: "PR.AC-4"
        version: "1.1"
        function: "Protect"
        category: "Access Control"
        description: "Tests if access permissions and authorizations are managed properly"
        version_notes: "Updated in CSF 1.1 with zero trust principles"
      - control_id: "ID.AM-3"
        version: "1.1"
        function: "Identify"
        category: "Asset Management"
        description: "Tests if organizational communication and data flows are mapped and understood"
        version_notes: "Refined in CSF 1.1 with data flow diagramming guidance"
    
    attack_categories:
      - name: "Unauthorized Tool Use"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent LLM from using tools without explicit authorization"
      - name: "Scope/Role Escalation"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent LLM from operating outside its designated role or scope"
      - name: "Command Execution"
        severity: "Critical"
        fips_impact: "High"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent LLM from attempting to execute unauthorized commands"
      - name: "User Manipulation"
        severity: "Medium"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent LLM from manipulating users into granting expanded privileges"

  # Jailbreak Strategy
  jailbreak:
    description: "Strategy for testing LLM security against jailbreak vulnerabilities"
    
    nist_sp_800_53:
      - control_id: "AC-3"
        version: "Rev 5"
        name: "Access Enforcement"
        description: "Tests if access control mechanisms can be circumvented"
        family: "Access Control"
        version_notes: "Updated in Rev 5 with additional enforcement mechanisms"
      - control_id: "SI-3"
        version: "Rev 5"
        name: "Malicious Code Protection" 
        description: "Tests if content filters prevent malicious inputs or instructions"
        family: "System and Information Integrity"
        version_notes: "Enhanced in Rev 5 with AI/ML-specific protections"
      - control_id: "SC-7"
        version: "Rev 5"
        name: "Boundary Protection"
        description: "Tests if system boundaries between allowed and prohibited content are enforced"
        family: "System and Communications Protection"
        version_notes: "Expanded in Rev 5 with information flow enforcement"
      - control_id: "AC-25"
        version: "Rev 5"
        name: "Reference Monitor"
        description: "Tests if security policy enforcement mechanisms can be bypassed"
        family: "Access Control"
        version_notes: "Introduced in Rev 4, refined in Rev 5"

    nist_ai_rmf:
      - control_id: "Map 1.3"
        version: "1.0"
        category: "Context"
        description: "Tests if LLM understands and enforces ethical boundaries in all contexts"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Measure 3.2"
        version: "1.0"
        category: "Performance"
        description: "Tests LLM robustness against specially crafted inputs designed to bypass controls"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Manage 2.1"
        version: "1.0"
        category: "Security"
        description: "Tests security controls for resistance to control bypassing techniques"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Govern 2.2"
        version: "1.0"
        category: "Accountability"
        description: "Tests compliance with governance directives under adversarial conditions"
        version_notes: "Initial release in AI RMF 1.0"

    nist_csf:
      - control_id: "PR.AC-5"
        version: "1.1"
        function: "Protect"
        category: "Access Control"
        description: "Tests if network integrity is protected through segregation of prohibited content"
        version_notes: "Updated in CSF 1.1 with zero trust architecture guidance"
      - control_id: "DE.CM-1"
        version: "1.1"
        function: "Detect"
        category: "Security Continuous Monitoring"
        description: "Tests if the network is monitored to detect potential jailbreak attempts"
        version_notes: "Enhanced in CSF 1.1 with continuous monitoring emphasis"
      - control_id: "PR.IP-1"
        version: "1.1"
        function: "Protect"
        category: "Information Protection Processes and Procedures"
        description: "Tests if baseline configuration of systems is resilient against jailbreak attempts"
        version_notes: "Refined in CSF 1.1 with secure configuration guidance"
    
    attack_categories:
      - name: "Character Formatting Tricks"
        severity: "Medium"
        fips_impact: "Low"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent bypassing content filters with Unicode or formatting tricks"
      - name: "Context Corruption"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent misleading the LLM about its operating context"
      - name: "Token Manipulation"
        severity: "Medium"
        fips_impact: "Low"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent manipulation of token boundaries to bypass filters"
      - name: "Semantic Confusion"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent semantic attacks that confuse the LLM into bypassing restrictions"

  # Prompt Injection
  prompt_injection:
    description: "Strategy for testing LLM security against prompt injection vulnerabilities"
    
    nist_sp_800_53:
      - control_id: "SI-10"
        version: "Rev 5"
        name: "Information Input Validation"
        description: "Tests if user inputs are properly validated to prevent injection attacks"
        family: "System and Information Integrity"
        version_notes: "Enhanced in Rev 5 with error handling requirements"
      - control_id: "AC-4"
        version: "Rev 5"
        name: "Information Flow Enforcement"
        description: "Tests if information flow between prompts and responses is properly controlled"
        family: "Access Control"
        version_notes: "Expanded in Rev 5 with data flow control mechanisms"
      - control_id: "SI-7"
        version: "Rev 5"
        name: "Software, Firmware, and Information Integrity"
        description: "Tests if prompt integrity is maintained throughout processing"
        family: "System and Information Integrity"
        version_notes: "Enhanced in Rev 5 with integrity verification techniques"
      - control_id: "SC-18"
        version: "Rev 5"
        name: "Mobile Code"
        description: "Tests if the system prevents execution of injected prompt code"
        family: "System and Communications Protection"
        version_notes: "Updated in Rev 5 to include scripting languages and LLM contexts"

    nist_ai_rmf:
      - control_id: "Map 2.2"
        version: "1.0"
        category: "Risks"
        description: "Tests if prompt injection risks are identified and mitigated"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Measure 2.1"
        version: "1.0"
        category: "Testing"
        description: "Tests LLM resilience against various injection techniques"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Manage 2.4"
        version: "1.0"
        category: "Security"
        description: "Tests implementation of security controls specific to prompt injection"
        version_notes: "Initial release in AI RMF 1.0"
      - control_id: "Govern 1.3"
        version: "1.0"
        category: "Accountability"
        description: "Tests governance mechanisms for preventing prompt overrides"
        version_notes: "Initial release in AI RMF 1.0"

    nist_csf:
      - control_id: "PR.DS-2"
        version: "1.1"
        function: "Protect"
        category: "Data Security"
        description: "Tests if data-in-transit is protected from injection"
        version_notes: "Updated in CSF 1.1 with additional safeguards"
      - control_id: "PR.DS-6"
        version: "1.1"
        function: "Protect"
        category: "Data Security"
        description: "Tests if integrity checking mechanisms are used to verify prompt integrity"
        version_notes: "Refined in CSF 1.1 with integrity verification guidance"
      - control_id: "DE.CM-4"
        version: "1.1"
        function: "Detect"
        category: "Security Continuous Monitoring"
        description: "Tests if malicious code injection is detected"
        version_notes: "Enhanced in CSF 1.1 with real-time monitoring emphasis"
    
    attack_categories:
      - name: "Direct Prompt Injection"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent direct injection of malicious prompts"
      - name: "Context Switching"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent switching context to execute arbitrary instructions"
      - name: "System Prompt Extraction"
        severity: "Critical"
        fips_impact: "High"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent extraction of system prompts or instruction sets"
      - name: "Indirect Prompt Injection"
        severity: "High"
        fips_impact: "Moderate"
        fips_version: "FIPS 199 (2004)"
        control_objective: "Prevent injection through indirectly interpreted content"

  # Add mappings for other attack strategies here
  # [Additional strategies like sensitive_info_disclosure, model_dos, etc. would follow the same pattern]

testing_requirements:
  version: "1.0.0"
  last_updated: "2025-05-20"
  documentation:
    - test_id: "NIST-LLM-SEC-001"
      version: "1.0"
      name: "Documentation Requirements"
      description: "Each test must document procedure, expected results, actual results, and remediation"
      version_notes: "Initial requirement established in 2025"
    - test_id: "NIST-LLM-SEC-002" 
      version: "1.0"
      name: "Version Control"
      description: "Tests must be versioned and changes documented for audit purposes"
      version_notes: "Initial requirement established in 2025"
  
  attestation:
    - attestation_id: "NIST-ATTEST-001"
      version: "1.0"
      name: "Test Coverage Attestation"
      description: "Attestation that all required controls have been tested"
      version_notes: "Aligns with SP 800-53 Rev 5 attestation requirements"
    - attestation_id: "NIST-ATTEST-002"
      version: "1.0"
      name: "Risk Assessment Attestation"
      description: "Attestation that residual risks have been assessed and accepted"
      version_notes: "Aligns with NIST AI RMF v1.0 risk acceptance criteria"

  remediation:
    - remediation_id: "NIST-REM-001"
      version: "1.0"
      name: "Remediation Requirements"
      description: "Each failed test must have documented remediation steps"
      version_notes: "Follows NIST SP 800-53 Rev 5 remediation documentation guidance"
    - remediation_id: "NIST-REM-002"
      version: "1.0"
      name: "Verification Requirements"
      description: "Remediation efficacy must be verified through retesting"
      version_notes: "Follows NIST CSF v1.1 verification protocols"
